# 支付服务

## 项目描述

```text
该项目主要用于各游戏服的支付
```

## 版本管理

- [PayServer](http://gogs.yh9228.com:3000/seetook/PayServer.git)

### 分支

```text
└── master                      主分支支付的主分支，目前发布也是使用该分支
        
```

## 文件结构

```text

├── config
│   │ 
│   ├── const*.js           对应支付渠道的配置
│   └── server.js           服务的相关配置主要包括[，各游戏服务的ip端口、数据库、接口{回调接口，同步接口},]
├── constant                常量文件目录
├── daifu                   代付相关服务层
├── html                    生成html文件目录      《主要用于某些支付渠道需要自己生成支付页面》
├── json                    json配置
├── key                     支付密钥公钥目录        《某些支付会使用到》
├── middleware              中间件目录
├── pay  
│   ├── pay*.js             各个支付渠道的下单，回调服务层
│   └── payUtil             支付相关的工具《封装了签名算法，http请求》
│     
└── index.js                web接口启动器,以及接口定义《定义了各渠道的下单和回调》       node 启动
```

## 注意事项

### 渠道定义

```text
渠道定义并没有以渠道实际名称定义，而是按照接入时间分配一个数字id,从1开始
例如: 
    第一个接入的渠道，配置常量文件名<const1.js>，接口服务文件名<pay1.js>
```

### 游戏服对接支付服

```text

├── app
│   │ 
│   ├─ servers                          服务实现《可参考pinus》
│   │   └── hall                        大厅服务
│   │       └── handler                 前端消息处理器
│   │            └── payHandler.ts      支付消息处理器，分发对应渠道支付下单请求到支付服务生成订单
│   └─ services                         服务层目录
│       └── payService                  支付服务目录
│                └── serverConfig.ts    支付服务对应渠道的http请求路径配置
└── dist                                ts编译后文件路径  
    └── config                          配置文件夹
        ├── pay                         支付文件夹
        │    └── payConfig.json         支付服务的配置，包括服务域名端口，密钥
        └── data                        配置目录
            └── payType.json            支付渠道商品配置

以上目录中新增一个支付渠道：
1.在payHandler中添加一个新渠道的支付数据构建
                    case 'ZYZF':
                    data.field1 = msg.currencyType + '-' + uid + '-' + serverConfig.payServer.path[53];
                    httpData.path = serverConfig.payServer.path[53];
                    break;
2.在serverConfig.ts中添加一个新渠道的请求路径配置

3.在payType.json添加对应渠道的商品

```

## 发布

```text
采用Jenkins发布服务
支付->支付代码更新
发布分支master
```
