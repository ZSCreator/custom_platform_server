const payUtil = require('../../../app/utils/payUtil');
const encryption = require('../../../app/common/encryption');
const json = require('../requestTest/test.json');
let SuccessNum = 0;
let loseNum = 0;
let allTime = 0;
let chaoshiNumLogin = 0;
async function clean() {
    let accountData = json;
    let num = 500;
    let questList = [];
    for (let i = 0; i < num; i++) {
        let item = accountData[i];
        let timestamp = 1589338001560;
        let agent = item.agent;
        let account = item.account;
        let param = { account: account, KindID: "1", language: 'chinese_zh' };
        let encrpParam = encryption.httpUrlEnCryPtionForParam(param);
        let key = encryption.MD5KEY(agent, timestamp);
        let body = {
            agent: agent,
            param: encrpParam,
            key: key,
            timestamp: timestamp,
        };
        questList.push(login(body));
    }
    const startTime = Date.now();
    await Promise.all(questList);
    const endTime = Date.now();
    allTime = endTime - startTime;
    console.warn(`登陆总并发请求:${num}, 总耗时：${allTime}毫秒, 超时：${chaoshiNumLogin} ,成功：${SuccessNum} ,失败：${loseNum}, 平均耗时：${allTime / num}毫秒`);
    process.exit();
}
async function login(body) {
    let httpData = {
        parameter: body,
        domainName: "nethttp.suphie.com",
        port: null,
        path: "third/login",
        isJson: null
    };
    const startTime = Date.now();
    const data = await payUtil.httpPostSendJson(httpData);
    const endTime = Date.now();
    if (endTime - startTime > 5000) {
        chaoshiNumLogin = chaoshiNumLogin + 1;
    }
    console.warn(`返回的code:${data.d.code}`);
    if (data.d.code == 0) {
        SuccessNum = SuccessNum + 1;
    }
    else {
        loseNum = loseNum + 1;
    }
}
setTimeout(clean, 2000);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVxdWVzdFRlc3RfbG9naW4uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi90b29scy9tb25nZGJUb015c3FsL3JlcXVlc3RUZXN0L1JlcXVlc3RUZXN0X2xvZ2luLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE1BQU0sT0FBTyxHQUFJLE9BQU8sQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO0FBQ3ZELE1BQU0sVUFBVSxHQUFJLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQzlELE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQ2pELElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQztBQUNuQixJQUFJLE9BQU8sR0FBRyxDQUFDLENBQUM7QUFDaEIsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDO0FBQ2hCLElBQUksZUFBZSxHQUFHLENBQUMsQ0FBQztBQUN4QixLQUFLLFVBQVUsS0FBSztJQUVoQixJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUM7SUFDdkIsSUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBQ2QsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ25CLEtBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFHLENBQUMsR0FBRyxHQUFHLEVBQUcsQ0FBQyxFQUFFLEVBQUM7UUFDMUIsSUFBSSxJQUFJLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLElBQUksU0FBUyxHQUFHLGFBQWEsQ0FBRTtRQUMvQixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ3ZCLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDM0IsSUFBSSxLQUFLLEdBQUcsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFJLE1BQU0sRUFBRyxHQUFHLEVBQUcsUUFBUSxFQUFHLFlBQVksRUFBRSxDQUFDO1FBQzNFLElBQUksVUFBVSxHQUFHLFVBQVUsQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3RCxJQUFJLEdBQUcsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBQyxTQUFTLENBQUMsQ0FBQztRQUM3QyxJQUFJLElBQUksR0FBRztZQUNQLEtBQUssRUFBRSxLQUFLO1lBQ1osS0FBSyxFQUFFLFVBQVU7WUFDakIsR0FBRyxFQUFHLEdBQUc7WUFDVCxTQUFTLEVBQUcsU0FBUztTQUN4QixDQUFDO1FBQ0YsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtLQUM5QjtJQUNELE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUM3QixNQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDOUIsTUFBTSxPQUFPLEdBQUksSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQzVCLE9BQU8sR0FBRyxPQUFPLEdBQUcsU0FBUyxDQUFDO0lBQzlCLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsT0FBTyxVQUFVLGVBQWUsUUFBUSxVQUFVLFFBQVEsT0FBTyxVQUFVLE9BQU8sR0FBQyxHQUFHLElBQUksQ0FBQyxDQUFBO0lBQy9ILE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNuQixDQUFDO0FBS0QsS0FBSyxVQUFXLEtBQUssQ0FBQyxJQUFVO0lBQzVCLElBQUksUUFBUSxHQUFRO1FBQ2hCLFNBQVMsRUFBRSxJQUFJO1FBQ2YsVUFBVSxFQUFFLG9CQUFvQjtRQUNoQyxJQUFJLEVBQUUsSUFBSTtRQUNWLElBQUksRUFBRSxhQUFhO1FBQ25CLE1BQU0sRUFBRSxJQUFJO0tBQ2YsQ0FBQTtJQUNELE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUM3QixNQUFNLElBQUksR0FBRyxNQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN0RCxNQUFNLE9BQU8sR0FBSSxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDNUIsSUFBRyxPQUFPLEdBQUcsU0FBUyxHQUFHLElBQUksRUFBQztRQUMxQixlQUFlLEdBQUcsZUFBZSxHQUFHLENBQUMsQ0FBQztLQUN6QztJQUNELE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUE7SUFDdEMsSUFBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLEVBQUM7UUFDaEIsVUFBVSxHQUFHLFVBQVUsR0FBRyxDQUFDLENBQUM7S0FDL0I7U0FBSTtRQUNELE9BQU8sR0FBRyxPQUFPLEdBQUcsQ0FBQyxDQUFDO0tBQ3pCO0FBQ0wsQ0FBQztBQUNELFVBQVUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMifQ==