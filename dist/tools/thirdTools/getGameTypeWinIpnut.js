"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const DatabaseService = require("../../app/services/databaseService");
const MongoManager = require("../../app/dao/dbManager/mongoManager");
const HallConst = require("../../app/consts/hallConst");
const dbMongo = require('../../config/db/mongo.json');
const RedisManager = require('../../app/dao/dbManager/redisManager');
const GameRecord = MongoManager.getDao('game_record');
const DayPlayerProfitsPayRecord = MongoManager.getDao('day_player_profits_pay_record');
DatabaseService.initConnection({
    "host": dbMongo.production.host,
    "port": dbMongo.production.port,
    "user": dbMongo.production.user,
    "pwd": dbMongo.production.pwd,
    "name": dbMongo.production.name,
});
async function statistic() {
    console.log('开始执行');
    try {
        const startTime = 1562378933000;
        const endTime = 1565234007000;
        let gameTypeList = HallConst.GAME_TYPE_CONST_NID;
        let resultList = [];
        const caipiaoNidList = HallConst.GAME_TYPE_CONST_NID[0].nidList;
        const pukerNidList = HallConst.GAME_TYPE_CONST_NID[1].nidList;
        const dianwanNidList = HallConst.GAME_TYPE_CONST_NID[2].nidList;
        const zhenrenNidList = HallConst.GAME_TYPE_CONST_NID[3].nidList;
        const liuhecaiNidList = HallConst.GAME_TYPE_CONST_NID[5].nidList;
        const [caipiao, puker, dianwan, zhenren, liuhecai] = await Promise.all([
            GameRecord.aggregate().match({ nid: { $in: caipiaoNidList }, createTime: { $gt: startTime, $lt: endTime } })
                .group({ _id: {}, 'win': { '$sum': '$win' }, 'input': { '$sum': '$input' }, 'profit': { '$sum': '$profit' } }),
            GameRecord.aggregate().match({ nid: { $in: pukerNidList }, createTime: { $gt: startTime, $lt: endTime } })
                .group({ _id: {}, 'win': { '$sum': '$win' }, 'input': { '$sum': '$input' }, 'profit': { '$sum': '$profit' } }),
            GameRecord.aggregate().match({ nid: { $in: dianwanNidList }, createTime: { $gt: startTime, $lt: endTime } })
                .group({ _id: {}, 'win': { '$sum': '$win' }, 'input': { '$sum': '$input' }, 'profit': { '$sum': '$profit' } }),
            GameRecord.aggregate().match({ nid: { $in: zhenrenNidList }, createTime: { $gt: startTime, $lt: endTime } })
                .group({ _id: {}, 'win': { '$sum': '$win' }, 'input': { '$sum': '$input' }, 'profit': { '$sum': '$profit' } }),
            GameRecord.aggregate().match({ nid: { $in: liuhecaiNidList }, createTime: { $gt: startTime, $lt: endTime } })
                .group({ _id: {}, 'win': { '$sum': '$win' }, 'input': { '$sum': '$input' }, 'profit': { '$sum': '$profit' } }),
        ]);
        const dayPlayerProfits = await DayPlayerProfitsPayRecord.aggregate().match({ createTime: { $gt: startTime, $lt: endTime }, })
            .group({ _id: { gameType: '$gameType' }, 'profits': { '$sum': '$profits' } });
        console.log('caipiao', caipiao);
        console.log('puker', puker);
        console.log('dianwan', dianwan);
        console.log('zhenren', zhenren);
        console.log('liuhecai', liuhecai);
        console.log('dayPlayerProfits', dayPlayerProfits);
        for (let item of gameTypeList) {
            let temp;
            if (item.value == HallConst.GAME_TYPE_NID[0].value) {
                temp = caipiao;
            }
            else if (item.value == HallConst.GAME_TYPE_CONST_NID[1].value) {
                temp = puker;
            }
            else if (item.value == HallConst.GAME_TYPE_CONST_NID[2].value) {
                temp = dianwan;
            }
            else if (item.value == HallConst.GAME_TYPE_CONST_NID[3].value) {
                temp = zhenren;
            }
            else if (item.value == HallConst.GAME_TYPE_CONST_NID[5].value) {
                temp = liuhecai;
            }
            else if (item.value == HallConst.GAME_TYPE_CONST_NID[4].value) {
                continue;
            }
            let info = {
                input: 0,
                win: 0,
                profits: 0,
                yingkui: 0,
                fanshui: 0,
                shijiProfits: 0,
                gameType: item.value
            };
            if (temp.length !== 0) {
                info.input = temp[0].input;
                info.win = temp[0].win;
                info.profits = temp[0].profit;
            }
            if (dayPlayerProfits.length != 0) {
                const temp1 = dayPlayerProfits.find(x => x._id.gameType == item.value);
                if (temp1) {
                    info.fanshui = temp1.profits;
                }
            }
            info.yingkui = info.profits;
            info.profits = 0 - info.profits;
            info.shijiProfits = info.profits - info.fanshui;
            resultList.push(info);
        }
        console.log(resultList);
    }
    catch (error) {
        console.log('error,error', error);
    }
    console.log('結束,addQudaoProfits');
}
statistic();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0R2FtZVR5cGVXaW5JcG51dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rvb2xzL3RoaXJkVG9vbHMvZ2V0R2FtZVR5cGVXaW5JcG51dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHNFQUF1RTtBQUN2RSxxRUFBc0U7QUFDdEUsd0RBQXdEO0FBRXhELE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO0FBQ3RELE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO0FBQ3JFLE1BQU0sVUFBVSxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDdEQsTUFBTSx5QkFBeUIsR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDLCtCQUErQixDQUFDLENBQUM7QUFDdkYsZUFBZSxDQUFDLGNBQWMsQ0FBQztJQUMzQixNQUFNLEVBQUUsT0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJO0lBQy9CLE1BQU0sRUFBRSxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUk7SUFDL0IsTUFBTSxFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSTtJQUMvQixLQUFLLEVBQUUsT0FBTyxDQUFDLFVBQVUsQ0FBQyxHQUFHO0lBQzdCLE1BQU0sRUFBRSxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUk7Q0FDbEMsQ0FBQyxDQUFDO0FBS0gsS0FBSyxVQUFVLFNBQVM7SUFDcEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNwQixJQUFJO1FBQ0ksTUFBTSxTQUFTLEdBQUcsYUFBYSxDQUFFO1FBQ2pDLE1BQU0sT0FBTyxHQUFHLGFBQWEsQ0FBRTtRQUMvQixJQUFJLFlBQVksR0FBRyxTQUFTLENBQUMsbUJBQW1CLENBQUM7UUFDakQsSUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLE1BQU0sY0FBYyxHQUFHLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7UUFDaEUsTUFBTSxZQUFZLEdBQUcsU0FBUyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUM5RCxNQUFNLGNBQWMsR0FBRyxTQUFTLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQ2hFLE1BQU0sY0FBYyxHQUFHLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7UUFDaEUsTUFBTSxlQUFlLEdBQUcsU0FBUyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUNqRSxNQUFNLENBQUMsT0FBTyxFQUFDLEtBQUssRUFBQyxPQUFPLEVBQUMsT0FBTyxFQUFDLFFBQVEsQ0FBQyxHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQztZQUMvRCxVQUFVLENBQUMsU0FBUyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUMsR0FBRyxFQUFDLEVBQUMsR0FBRyxFQUFDLGNBQWMsRUFBQyxFQUFFLFVBQVUsRUFBQyxFQUFDLEdBQUcsRUFBQyxTQUFTLEVBQUMsR0FBRyxFQUFFLE9BQU8sRUFBQyxFQUFDLENBQUM7aUJBQzVGLEtBQUssQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxFQUFHLE9BQU8sRUFBRSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBQyxRQUFRLEVBQUUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLEVBQUMsQ0FBQztZQUNsSCxVQUFVLENBQUMsU0FBUyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUMsR0FBRyxFQUFDLEVBQUMsR0FBRyxFQUFDLFlBQVksRUFBQyxFQUFFLFVBQVUsRUFBQyxFQUFDLEdBQUcsRUFBQyxTQUFTLEVBQUMsR0FBRyxFQUFFLE9BQU8sRUFBQyxFQUFDLENBQUM7aUJBQzFGLEtBQUssQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxFQUFHLE9BQU8sRUFBRSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBQyxRQUFRLEVBQUUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLEVBQUMsQ0FBQztZQUNqSCxVQUFVLENBQUMsU0FBUyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUMsR0FBRyxFQUFDLEVBQUMsR0FBRyxFQUFDLGNBQWMsRUFBQyxFQUFFLFVBQVUsRUFBQyxFQUFDLEdBQUcsRUFBQyxTQUFTLEVBQUMsR0FBRyxFQUFFLE9BQU8sRUFBQyxFQUFDLENBQUM7aUJBQzVGLEtBQUssQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxFQUFHLE9BQU8sRUFBRSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBQyxRQUFRLEVBQUUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLEVBQUMsQ0FBQztZQUNsSCxVQUFVLENBQUMsU0FBUyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUMsR0FBRyxFQUFDLEVBQUMsR0FBRyxFQUFDLGNBQWMsRUFBQyxFQUFFLFVBQVUsRUFBQyxFQUFDLEdBQUcsRUFBQyxTQUFTLEVBQUMsR0FBRyxFQUFFLE9BQU8sRUFBQyxFQUFDLENBQUM7aUJBQzVGLEtBQUssQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxFQUFHLE9BQU8sRUFBRSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBQyxRQUFRLEVBQUUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLEVBQUMsQ0FBQztZQUNsSCxVQUFVLENBQUMsU0FBUyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUMsR0FBRyxFQUFDLEVBQUMsR0FBRyxFQUFDLGVBQWUsRUFBQyxFQUFFLFVBQVUsRUFBQyxFQUFDLEdBQUcsRUFBQyxTQUFTLEVBQUMsR0FBRyxFQUFFLE9BQU8sRUFB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