'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.verifyMD5SignLower = exports.verifyMD5SignUpper = exports.signatureMD5Sign = exports.verifyMD5Sign = exports.signature = exports.parameterSort = exports.encryptMD5 = void 0;
const crypto = require('crypto');
const querystring = require('querystring');
const urlencode = require('urlencode');
const EncryptoUtil = module.exports;
const encryptMD5 = (content) => {
    try {
        const md5 = crypto.createHash('md5');
        md5.update(content + '');
        let result = md5.digest('hex');
        return result;
    }
    catch (e) {
        console.log("encryptMD5 error: " + e);
    }
};
exports.encryptMD5 = encryptMD5;
const parameterSort = (sortObj) => {
    let arr = [];
    let obj = {};
    for (let i in sortObj) {
        arr.push(i);
    }
    arr.sort(function (a, b) {
        let aa;
        let bb;
        let n = 0;
        aa = a[0].charCodeAt();
        bb = b[0].charCodeAt();
        while (aa == bb) {
            n++;
            aa = a[n] !== undefined ? a[n].charCodeAt() : 0;
            bb = b[n] !== undefined ? b[n].charCodeAt() : 0;
        }
        return aa - bb;
    });
    arr.forEach(m => {
        obj[m] = obj[m];
    });
    return obj;
};
exports.parameterSort = parameterSort;
const signature = (signSource, isUpper, isStringify) => {
    let sign;
    if (isStringify) {
        sign = querystring.stringify(signSource);
        sign = urlencode.decode(sign);
    }
    else {
        sign = signSource;
    }
    let md5 = crypto.createHash('md5');
    md5.update(sign);
    let signs = md5.digest('hex');
    if (isUpper)
        signs = signs.toUpperCase();
    return signs;
};
exports.signature = signature;
const verifyMD5Sign = (signSource, sign, key, keyName, isUpper, isStringify) => {
    let mySign = EncryptoUtil.signatureMD5Sign(signSource, key, keyName, isUpper, isStringify);
    return sign === mySign;
};
exports.verifyMD5Sign = verifyMD5Sign;
const signatureMD5Sign = (signSource, key, keyName, isUpper, isStringify) => {
    signSource = (0, exports.parameterSort)(signSource);
    signSource[keyName] = key;
    return EncryptoUtil.signature(signSource, isUpper, isStringify);
};
exports.signatureMD5Sign = signatureMD5Sign;
const verifyMD5SignUpper = (signSourceObj, sign, key, keyName) => {
    return EncryptoUtil.verifyMD5Sign(signSourceObj, sign, key, keyName, true, true);
};
exports.verifyMD5SignUpper = verifyMD5SignUpper;
const verifyMD5SignLower = (signSourceObj, sign, key, keyName) => {
    return EncryptoUtil.verifyMD5Sign(signSourceObj, sign, key, keyName, false, true);
};
exports.verifyMD5SignLower = verifyMD5SignLower;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW5jcnlwdFV0aWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9hcHAvdXRpbHMvRW5jcnlwdFV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7QUFDYixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDakMsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQzNDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN2QyxNQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDO0FBTzdCLE1BQU0sVUFBVSxHQUFHLENBQUMsT0FBTyxFQUFFLEVBQUU7SUFDbEMsSUFBSTtRQUNBLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDekIsSUFBSSxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMvQixPQUFPLE1BQU0sQ0FBQTtLQUNoQjtJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsR0FBRyxDQUFDLENBQUMsQ0FBQztLQUN6QztBQUVMLENBQUMsQ0FBQztBQVZXLFFBQUEsVUFBVSxjQVVyQjtBQU9LLE1BQU0sYUFBYSxHQUFHLENBQUMsT0FBTyxFQUFFLEVBQUU7SUFDckMsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ2IsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ2IsS0FBSyxJQUFJLENBQUMsSUFBSSxPQUFPLEVBQUU7UUFDbkIsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNmO0lBQ0QsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFD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